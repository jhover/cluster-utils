#!/usr/bin/env python
#
# qacct -j -d 1 -o hover

import os
import pwd
import subprocess
import sys

print("qhist")
#  jobnum  jobname  slots  exit_status  wallclock  maxvmem

def get_username():
    return pwd.getpwuid( os.getuid() )[ 0 ]

def get_history(days=1, user=get_username()):
    cmd = f"qacct -j -d  1 -o {user}"
    result = subprocess.check_output( cmd, shell=True, text=True )
    lines = result.split('\n')
    info = parse_output(lines)
    print(f"got {len(info)} items")
    return info

def parse_output(lines):
    lod = []
    current = None
    for line in lines:
        if line.startswith("======="):
            if current is not None:
                lod.append(current)
                current = {}
        else:
            key = line[0:13].strip()
            value = line[13:].strip()
            print(f"{key} = {value}")
            if key == "jobnumber":
                current['jobnumber'] = value
            elif key == "exit_status":
                current["exit_status"] = value
    
    return lod    

if __name__ == '__main__':
    lines = get_history()
    